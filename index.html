<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>PathsINverleith</title>

	<link rel="stylesheet" href="css/main.css">
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.2/mapbox.css' rel='stylesheet' />
	<link rel="stylesheet" href="css/style.css" media="screen" type="text/css" />
	<link rel="stylesheet" href="css/main.css" media="screen" type="text/css" />

	<script src="js/jquery.js"></script>
	<!-- <script src="js/jquery-1.11.1.min.js"></script> -->
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.2/mapbox.js'></script>


<script>

	$(document).ready(function() {

      $("#map-container").load("draw-map.html"); 

	});

	$(window).resize(function(){
		setSectionsWithImagebackgrounds();
	});

	$(window).load(function () {

        
		setSectionsWithImagebackgrounds();

		var x = getRatio($('#blackMap').attr('src'));
		console.log(x);
	});


	function setSectionsWithImagebackgrounds() {
		$('section.imgSection').each(
			function() {
				console.log('imgSection ' + $(this).attr('id'));
				calculateHeight($(this));
			}
		)
	}

	function calculateHeight(id) {

		imgSrc = $(id).find('.backgroundImage').attr('src');

		var ratio = getRatio(imgSrc);
//		console.log('ratio: ' + ratio);

		var currentWidth = $(window).width();
		var newH = currentWidth / ratio;

		//console.log('ratio. ' + ratio + ' width: ' + currentWidth + ' newHeight:' + newH);
		$(id).height(newH + 'px');
	}

	function getRatio(src)
	{
		var newImg = new Image();
		newImg.src = src;

		var height = newImg.height;
		var width = newImg.width;
		
		console.log('getRatio:  ' + newImg , 'src: ' + src,  'imgsrc: ' + newImg.src);

		return  width / height;	
	}


	function showthetool() {
        
        var freeSpaceH = $(window).height() - $('header').height();
        var viewportHeigth = freeSpaceH * 0.7;

        var paddingTop = freeSpaceH * 0.15;
        jQuery("#map-container").css({"visibility": "visible","padding-top": paddingTop + "px"});
        
        jQuery("#map").hide().css({"visibility":"visible", "height": viewportHeigth + "px"}).show("slow");


		var screenHeight = $(document).height();
        jQuery("#overlay").css("visibility", "visible").height(screenHeight).animate({ opacity: '0.8' }, "slow");

        console.log('showthetool: ' + viewportHeigth);
    }

    function hideMap() {
    	jQuery("#map-container").css("visibility", "hidden");
    	jQuery("#map").hide().css("visibility","hidden");
    	jQuery("#overlay").css("visibility", "hidden");
    	
    }

	</script>


</head>
<body>

	<div id="overlay" onclick="hideMap()"></div>

	<div id="map-container"></div>

	<header>
		<div class="module-padding">
			<div class="width-sizer">
				<a id="header-logo"href=""><img src="img/path_logo.png" alt="bike logo"></a>
				<div class="filler"></div>
				<a id="burger-button" href="#"><img src="img/burger2.png" alt=""></a>
				<ul id="header-nav">
					<li><a a href="javascript:void(0);" onclick="showthetool()">GET STARTED</a></li>
					<li><a href="">ABOUT US</a></li>
					<li><a href="">THE MAP</a></li>
				</ul>
			</div>
		</div>
	</header>


	<section id="intro-sec" class="imgSection">
		<img id="bikes" class="backgroundImage" src="img/bg_bikes.png" alt="">
		<div class="section-Padding" >
			<div class="width-sizer">
				<h1><span>PATHS</span> / Inverleith</h1>
				<h3>Mapping the journeys through your local community</h3>

				<div class="btn-container">
					<div class="main-btn"><a href="javascript:void(0);" onclick="showthetool()">Get started</a></div>
					<div class="main-btn"><a href="">Learn more</a></div>
				</div>
			</div>
		</div>
	</section>

	<section id="about-sec" class="imgSection">
		<img src="img/bg_inverleith.png" alt="" class="backgroundImage">
		<div class="section-Padding">
			<div class="width-sizer">
				<h2>What's it all about?</h2>
				<p>Whether you walk, cycle, drive or get a lift, draw your daily route on the interactive map, save your Path and see how other people in your local community are travelling around the area. </p>
				<br>
				<p>Come join us on Thursday 30th October from 6-9pm at Broughton High School to find out about tips, advice and support available to help you get started, to share ......</p>
			</div>
		</div>
	</section>



	<section id="map-sec" class="imgSection">
		<img id="blackMap" class="backgroundImage" src="img/blackMap.png" alt="">
		<div class="section-Padding">
			<div class="width-sizer">
				<h2>Here would be the output of our data.... processor or 3djs or something</h2>
			</div>
		</div>
	</section>


	<section id="team-sec">
		<div class="section-Padding">
			<div class="width-sizer">
				<h2>About us</h2>
				<p>Come join us on Thursday 30th October from 6-9pm at Broughton High School to find out about tips, advice and support available to help you get started, to share ......</p>
			</div>
		</div>
	</section>


	<footer>
		<div class="section-Padding">
			<div class="width-sizer">
				<img src="img/bi-logo.png" alt="logo beta-informatics">
				<img src="img/uedin_logo.png" alt="logo University of Edinburgh">

				<ul>
					<li><a href="#">FAQ</a></li>
					<li><a href="#">Contact us</a></li>
					<li><a href="#">Living Lab</a></li>
					<!-- <li><a href="#">Edinburgh Council?</a></li>
					<li><a href="#">Edinburgh Neighbourhood thing?</a></li>
 -->				</ul>
			</div>
		</div>
	</footer>



</body>
</html>